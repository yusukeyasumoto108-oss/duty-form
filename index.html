<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2026å¹´3æœˆ å½“ç›´å¸Œæœ›åé›†ãƒ•ã‚©ãƒ¼ãƒ ï½œæ¿æ©‹ä¸­å¤®ç·åˆç—…é™¢</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Shippori+Mincho:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #0f2240; --navy-mid: #1a3660;
    --teal: #1a7f7a; --teal-light: #22a39d; --teal-pale: #e6f5f4;
    --gold: #c9a84c;
    --cream: #faf8f3;
    --text: #1a1a2e; --text-mid: #4a5568; --text-light: #718096;
    --border: #dde3ec; --white: #ffffff;
    --red: #c0392b; --red-pale: #fdf0ee;
    --orange: #d97706; --orange-pale: #fef3c7;
    --green: #16a34a; --green-pale: #f0fdf4;
    --shadow: 0 4px 24px rgba(15,34,64,0.10);
    --shadow-sm: 0 2px 8px rgba(15,34,64,0.07);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Noto Sans JP', sans-serif; background: var(--cream); color: var(--text); min-height: 100vh; }

  header { background: var(--navy); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 12px rgba(0,0,0,0.18); }
  .header-inner { max-width: 960px; margin: 0 auto; padding: 18px 24px; display: flex; align-items: center; justify-content: space-between; gap: 16px; }
  .header-title { font-family: 'Shippori Mincho', serif; color: var(--white); font-size: 1.1rem; font-weight: 700; letter-spacing: 0.04em; line-height: 1.4; }
  .header-title span { display: block; font-size: 0.72rem; font-family: 'Noto Sans JP', sans-serif; font-weight: 300; color: rgba(255,255,255,0.65); }
  .header-badge { background: var(--gold); color: var(--navy); font-size: 0.72rem; font-weight: 700; padding: 4px 12px; border-radius: 20px; white-space: nowrap; }

  main { max-width: 960px; margin: 0 auto; padding: 28px 16px 60px; }

  .steps { display: flex; align-items: center; background: var(--white); border-radius: 12px; padding: 14px 24px; margin-bottom: 22px; box-shadow: var(--shadow-sm); gap: 4px; }
  .step { flex: 1; display: flex; align-items: center; gap: 8px; position: relative; }
  .step:not(:last-child)::after { content: ''; position: absolute; right: -4px; top: 50%; transform: translateY(-50%); width: 8px; height: 2px; background: var(--border); }
  .step-num { width: 26px; height: 26px; border-radius: 50%; background: var(--border); color: var(--text-mid); font-size: 0.75rem; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.3s; }
  .step.active .step-num { background: var(--navy); color: var(--white); }
  .step.done .step-num { background: var(--teal); color: var(--white); }
  .step-label { font-size: 0.76rem; color: var(--text-light); }
  .step.active .step-label { color: var(--navy); font-weight: 700; }
  .step.done .step-label { color: var(--teal); }

  .progress-tracker { background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 16px 24px; margin-bottom: 22px; box-shadow: var(--shadow-sm); }
  .progress-title { font-size: 0.78rem; font-weight: 700; color: var(--text-mid); margin-bottom: 10px; }
  .progress-bar-wrap { background: var(--border); border-radius: 20px; height: 7px; overflow: hidden; margin-bottom: 12px; }
  .progress-bar-fill { height: 100%; background: linear-gradient(90deg, var(--teal), var(--teal-light)); border-radius: 20px; transition: width 0.5s ease; }
  .progress-doctors { display: flex; gap: 8px; flex-wrap: wrap; }
  .progress-doctor-tag { font-size: 0.72rem; padding: 3px 10px; border-radius: 20px; background: var(--border); color: var(--text-light); font-weight: 500; }
  .progress-doctor-tag.done { background: var(--teal-pale); color: var(--teal); font-weight: 700; }
  .progress-doctor-tag.done::before { content: 'âœ“ '; }

  .card { background: var(--white); border-radius: 14px; box-shadow: var(--shadow); margin-bottom: 22px; overflow: hidden; border: 1px solid var(--border); }
  .card-anim { animation: fadeUp 0.35s ease both; }
  @keyframes fadeUp { from { opacity:0; transform:translateY(14px); } to { opacity:1; transform:translateY(0); } }
  .card-header { background: linear-gradient(135deg, var(--navy) 0%, var(--navy-mid) 100%); padding: 16px 24px; display: flex; align-items: center; gap: 14px; }
  .card-header-icon { width: 36px; height: 36px; background: rgba(255,255,255,0.12); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; }
  .card-header-text h2 { font-family: 'Shippori Mincho', serif; font-size: 1rem; color: var(--white); font-weight: 700; margin-bottom: 2px; }
  .card-header-text p { font-size: 0.7rem; color: rgba(255,255,255,0.6); font-weight: 300; }
  .card-body { padding: 22px 24px; }

  .doctor-select-label { font-size: 0.82rem; font-weight: 700; color: var(--navy); margin-bottom: 10px; }
  .doctor-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; }
  .doctor-btn { padding: 12px 8px; border: 2px solid var(--border); border-radius: 10px; background: var(--white); cursor: pointer; text-align: center; font-family: 'Noto Sans JP', sans-serif; font-size: 0.9rem; font-weight: 500; color: var(--text-mid); transition: all 0.2s; position: relative; }
  .doctor-btn:hover { border-color: var(--teal-light); color: var(--teal); background: var(--teal-pale); }
  .doctor-btn.selected { border-color: var(--navy); background: var(--navy); color: var(--white); }
  .doctor-btn .doctor-day { display: block; font-size: 0.65rem; font-weight: 300; margin-top: 3px; opacity: 0.7; }
  .doctor-btn.selected .doctor-day { opacity: 0.8; }
  .doctor-btn .done-mark { position: absolute; top: 4px; right: 6px; font-size: 0.7rem; color: var(--teal-light); display: none; }
  .doctor-btn.submitted .done-mark { display: block; }
  .doctor-btn.submitted { border-color: var(--teal); }

  .notice { border-radius: 10px; padding: 12px 14px; margin-bottom: 16px; font-size: 0.8rem; display: flex; gap: 10px; align-items: flex-start; line-height: 1.6; }
  .notice-icon { font-size: 1rem; flex-shrink: 0; margin-top: 1px; }
  .notice.info { background: #e8f4fd; border-left: 3px solid #3b82f6; color: #1e40af; }
  .notice.warn { background: var(--orange-pale); border-left: 3px solid var(--orange); color: #92400e; }

  /* TABS */
  .tabs { display: flex; gap: 3px; border-bottom: 2px solid var(--border); overflow-x: auto; }
  .tab-btn { padding: 9px 16px; border: none; background: none; font-family: 'Noto Sans JP', sans-serif; font-size: 0.8rem; font-weight: 500; color: var(--text-light); cursor: pointer; border-bottom: 3px solid transparent; margin-bottom: -2px; white-space: nowrap; transition: all 0.18s; border-radius: 6px 6px 0 0; }
  .tab-btn:hover { color: var(--navy); background: #f3f6fb; }
  .tab-btn.active { color: var(--navy); font-weight: 700; border-bottom-color: var(--navy); }
  .tab-badge { display: inline-block; font-size: 0.63rem; padding: 1px 6px; border-radius: 10px; margin-left: 5px; background: var(--border); color: var(--text-mid); font-weight: 600; vertical-align: middle; }
  .tab-btn.active .tab-badge { background: var(--navy); color: var(--white); }
  .tab-badge.ng { background: #fde8e8; color: var(--red); }
  .tab-badge.prefer { background: #e0e8ff; color: #1d4ed8; }

  .tab-panel { display: none; padding-top: 18px; }
  .tab-panel.active { display: block; animation: fadeUp 0.22s ease; }

  /* TABLE */
  table.pref-table { width: 100%; border-collapse: collapse; font-size: 0.82rem; }
  table.pref-table thead th { background: #f3f6fb; color: var(--text-mid); font-weight: 700; font-size: 0.72rem; letter-spacing: 0.04em; padding: 9px 12px; text-align: left; border-bottom: 2px solid var(--border); }
  table.pref-table tbody tr { border-bottom: 1px solid var(--border); transition: background 0.12s; }
  table.pref-table tbody tr:last-child { border-bottom: none; }
  table.pref-table tbody tr:hover { background: #f9fbff; }
  table.pref-table tbody tr.my-day { background: #eef1ff; }
  table.pref-table tbody tr.my-day:hover { background: #e4e9ff; }
  table.pref-table tbody tr.ext-yamato { background: var(--teal-pale); }
  table.pref-table tbody tr.ext-yamato:hover { background: #d6f0ef; }
  table.pref-table tbody tr.ext-uenohara { background: var(--orange-pale); }
  table.pref-table tbody tr.ext-uenohara:hover { background: #fde9c0; }
  table.pref-table td { padding: 9px 12px; vertical-align: middle; }

  .date-cell { font-weight: 700; font-size: 0.85rem; white-space: nowrap; }
  .day-badge { display: inline-block; padding: 2px 7px; border-radius: 20px; font-size: 0.67rem; font-weight: 700; margin-left: 4px; }
  .day-badge.sun { background: #fde8e8; color: var(--red); }
  .day-badge.mon { background: #e8eeff; color: #3b4dc4; }
  .day-badge.tue { background: #f0e8ff; color: #6b21a8; }
  .day-badge.wed { background: #e8f4fd; color: #1e40af; }
  .day-badge.thu { background: #e8fff2; color: #166534; }
  .day-badge.fri { background: #fff8e8; color: #92400e; }
  .day-badge.sat { background: #fdf4ff; color: #86198f; }

  .my-lbl { display: inline-block; font-size: 0.6rem; font-weight: 700; background: #1d4ed8; color: white; padding: 1px 5px; border-radius: 3px; margin-left: 4px; vertical-align: middle; }
  .duty-type { font-size: 0.75rem; color: var(--text-mid); background: #f3f6fb; padding: 2px 7px; border-radius: 5px; font-weight: 500; }

  .pref-radio-group { display: flex; gap: 5px; }
  .pref-radio-group input[type="radio"] { display: none; }
  .pref-radio-group label { padding: 4px 10px; border-radius: 6px; border: 1.5px solid var(--border); font-size: 0.72rem; font-weight: 500; cursor: pointer; color: var(--text-mid); transition: all 0.13s; white-space: nowrap; user-select: none; }
  .pref-radio-group input[value="ok"]+label { border-color: #86efac; color: var(--green); }
  .pref-radio-group input[value="ok"]:checked+label { background: var(--green); color: #fff; border-color: var(--green); }
  .pref-radio-group input[value="prefer"]+label { border-color: #93c5fd; color: #1d4ed8; }
  .pref-radio-group input[value="prefer"]:checked+label { background: #1d4ed8; color: #fff; border-color: #1d4ed8; }
  .pref-radio-group input[value="ng"]+label { border-color: #fca5a5; color: var(--red); }
  .pref-radio-group input[value="ng"]:checked+label { background: var(--red); color: #fff; border-color: var(--red); }

  .bulk-row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
  .bulk-lbl { font-size: 0.73rem; color: var(--text-light); }
  .bulk-btn { padding: 3px 11px; border-radius: 6px; border: 1.5px solid var(--border); font-size: 0.71rem; font-weight: 600; cursor: pointer; background: var(--white); color: var(--text-mid); font-family: 'Noto Sans JP', sans-serif; transition: all 0.13s; }
  .bulk-btn:hover { background: #f3f6fb; }
  .bulk-btn.ok { border-color: #86efac; color: var(--green); }
  .bulk-btn.ok:hover { background: var(--green-pale); }
  .bulk-btn.ng { border-color: #fca5a5; color: var(--red); }
  .bulk-btn.ng:hover { background: var(--red-pale); }

  .legend { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 14px; }
  .legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.74rem; color: var(--text-mid); }
  .legend-dot { width: 10px; height: 10px; border-radius: 3px; }

  .comment-field { margin-top: 20px; }
  .comment-field label { display: block; font-size: 0.82rem; font-weight: 700; color: var(--navy); margin-bottom: 8px; }
  .comment-field textarea { width: 100%; padding: 11px 13px; border: 1.5px solid var(--border); border-radius: 10px; font-family: 'Noto Sans JP', sans-serif; font-size: 0.84rem; color: var(--text); resize: vertical; min-height: 72px; transition: border-color 0.18s; background: var(--cream); }
  .comment-field textarea:focus { outline: none; border-color: var(--teal-light); background: var(--white); }

  .submit-wrap { display: flex; justify-content: flex-end; gap: 12px; margin-top: 22px; padding-top: 18px; border-top: 1px solid var(--border); }
  .btn { padding: 11px 26px; border-radius: 10px; font-family: 'Noto Sans JP', sans-serif; font-weight: 700; font-size: 0.86rem; cursor: pointer; transition: all 0.18s; border: none; letter-spacing: 0.04em; }
  .btn-outline { background: var(--white); border: 2px solid var(--border); color: var(--text-mid); }
  .btn-outline:hover { border-color: var(--text-mid); }
  .btn-primary { background: linear-gradient(135deg, var(--navy), var(--navy-mid)); color: var(--white); box-shadow: 0 4px 14px rgba(15,34,64,0.25); }
  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(15,34,64,0.3); }

  #summary-view { display: none; }
  #summary-view.visible { display: block; animation: fadeUp 0.35s ease; }
  .summary-table { width: 100%; border-collapse: collapse; font-size: 0.81rem; }
  .summary-table th { background: #f3f6fb; padding: 9px 12px; text-align: left; font-weight: 700; font-size: 0.72rem; color: var(--text-mid); border-bottom: 2px solid var(--border); }
  .summary-table td { padding: 9px 12px; border-bottom: 1px solid var(--border); vertical-align: middle; }
  .pref-pill { display: inline-block; padding: 2px 9px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; }
  .pref-ok { background: var(--green-pale); color: var(--green); }
  .pref-prefer { background: #eff6ff; color: #1d4ed8; }
  .pref-ng { background: var(--red-pale); color: var(--red); }
  .pref-unset { background: #f3f6fb; color: var(--text-light); }

  #form-content { display: none; }
  #form-content.visible { display: block; animation: fadeUp 0.3s ease; }

  @media (max-width: 600px) {
    .header-inner { flex-direction: column; align-items: flex-start; }
    .doctor-grid { grid-template-columns: repeat(3, 1fr); }
    table.pref-table { font-size: 0.72rem; }
    .pref-radio-group label { padding: 3px 7px; font-size: 0.67rem; }
    .submit-wrap { flex-direction: column; }
    .btn { width: 100%; }
  }
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="header-title">
      <span>æ¿æ©‹ä¸­å¤®ç·åˆç—…é™¢</span>
      2026å¹´3æœˆ å½“ç›´å¸Œæœ›åé›†ãƒ•ã‚©ãƒ¼ãƒ 
    </div>
    <div class="header-badge">ç· åˆ‡ï¼šç®¡ç†è€…æŒ‡å®šæ—¥ã¾ã§</div>
  </div>
</header>

<main>

  <div class="steps">
    <div class="step active" id="step1"><div class="step-num">1</div><div class="step-label">åŒ»å¸«ã‚’é¸æŠ</div></div>
    <div class="step" id="step2"><div class="step-num">2</div><div class="step-label">å¸Œæœ›ã‚’å…¥åŠ›</div></div>
    <div class="step" id="step3"><div class="step-num">3</div><div class="step-label">ç¢ºèªãƒ»é€ä¿¡</div></div>
    <div class="step" id="step4"><div class="step-num">4</div><div class="step-label">å®Œäº†</div></div>
  </div>

  <div class="progress-tracker">
    <div class="progress-title">å›ç­”çŠ¶æ³ï¼ˆ<span id="progress-count">0</span> / 7å å®Œäº†ï¼‰</div>
    <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progress-bar" style="width:0%"></div></div>
    <div class="progress-doctors" id="progress-doctors">
      <span class="progress-doctor-tag" data-doc="å®‰æœ¬">å®‰æœ¬</span>
      <span class="progress-doctor-tag" data-doc="ç¦å¶‹">ç¦å¶‹</span>
      <span class="progress-doctor-tag" data-doc="åŠ è—¤">åŠ è—¤</span>
      <span class="progress-doctor-tag" data-doc="æ¾å…ƒ">æ¾å…ƒ</span>
      <span class="progress-doctor-tag" data-doc="èµåŸ">èµåŸ</span>
      <span class="progress-doctor-tag" data-doc="å…¨">å…¨</span>
      <span class="progress-doctor-tag" data-doc="å’Œæ‰">å’Œæ‰</span>
    </div>
  </div>

  <!-- SELECTOR -->
  <div class="card card-anim" id="selector-card">
    <div class="card-header">
      <div class="card-header-icon">ğŸ‘¨â€âš•ï¸</div>
      <div class="card-header-text">
        <h2>æ°åã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
        <p>ã‚ãªãŸã®åå‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å¸Œæœ›å…¥åŠ›ã‚’é–‹å§‹ã—ã¾ã™</p>
      </div>
    </div>
    <div class="card-body">
      <div class="notice info">
        <span class="notice-icon">â„¹ï¸</span>
        <div>æ‹…å½“æ›œæ—¥ä»¥å¤–ã‚’å«ã‚€<strong>3æœˆã™ã¹ã¦ã®å½“ç›´æ—¥ç¨‹</strong>ã«ã¤ã„ã¦ã€Œå¯ã€ã€Œå¸Œæœ›ã™ã‚‹ã€ã€Œä¸å¯ã€ã‚’ã”å›ç­”ãã ã•ã„ã€‚å¤–éƒ¨ç—…é™¢ï¼ˆæ±äº¬å¤§å’Œãƒ»ä¸Šé‡åŸï¼‰ã¸ã®æ´¾é£æ—¥ç¨‹ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚</div>
      </div>
      <div class="doctor-select-label">åŒ»å¸«ã‚’é¸æŠ</div>
      <div class="doctor-grid">
        <button class="doctor-btn" onclick="selectDoctor('å®‰æœ¬')" id="btn-å®‰æœ¬">å®‰æœ¬<span class="doctor-day">æ‹…å½“ï¼šæœˆ</span><span class="done-mark">âœ“</span></button>
        <button class="doctor-btn" onclick="selectDoctor('ç¦å¶‹')" id="btn-ç¦å¶‹">ç¦å¶‹<span class="doctor-day">æ‹…å½“ï¼šç«</span><span class="done-mark">âœ“</span></button>
        <button class="doctor-btn" onclick="selectDoctor('åŠ è—¤')" id="btn-åŠ è—¤">åŠ è—¤<span class="doctor-day">æ‹…å½“ï¼šæ°´</span><span class="done-mark">âœ“</span></button>
        <button class="doctor-btn" onclick="selectDoctor('æ¾å…ƒ')" id="btn-æ¾å…ƒ">æ¾å…ƒ<span class="doctor-day">æ‹…å½“ï¼šæ°´</span><span class="done-mark">âœ“</span></button>
        <button class="doctor-btn" onclick="selectDoctor('èµåŸ')" id="btn-èµåŸ">èµåŸ<span class="doctor-day">æ‹…å½“ï¼šæœ¨</span><span class="done-mark">âœ“</span></button>
        <button class="doctor-btn" onclick="selectDoctor('å…¨')" id="btn-å…¨">å…¨<span class="doctor-day">æ‹…å½“ï¼šé‡‘</span><span class="done-mark">âœ“</span></button>
        <button class="doctor-btn" onclick="selectDoctor('å’Œæ‰')" id="btn-å’Œæ‰">å’Œæ‰<span class="doctor-day">æ‹…å½“ï¼šåœŸ</span><span class="done-mark">âœ“</span></button>
      </div>
    </div>
  </div>

  <!-- FORM -->
  <div id="form-content">
    <div class="card">
      <div class="card-header">
        <div class="card-header-icon">ğŸ“…</div>
        <div class="card-header-text">
          <h2 id="form-doctor-name">å…ˆç”Ÿ</h2>
          <p>2026å¹´3æœˆ å½“ç›´å¸Œæœ›å…¥åŠ› â€• å…¨æ—¥ç¨‹</p>
        </div>
      </div>
      <div class="card-body">

        <div class="legend">
          <div class="legend-item"><div class="legend-dot" style="background:#16a34a"></div>å¯ï¼ˆã©ã¡ã‚‰ã§ã‚‚ï¼‰</div>
          <div class="legend-item"><div class="legend-dot" style="background:#1d4ed8"></div>å¸Œæœ›ã™ã‚‹</div>
          <div class="legend-item"><div class="legend-dot" style="background:#c0392b"></div>ä¸å¯</div>
          <div class="legend-item"><div class="legend-dot" style="background:#eef1ff;border:1px solid #c0caff"></div>æ‹…å½“æ›œæ—¥</div>
        </div>

        <div class="tabs" id="form-tabs">
          <button class="tab-btn active" onclick="switchTab('itabashi',this)">æ¿æ©‹ä¸­å¤®ç·åˆç—…é™¢<span class="tab-badge" id="badge-itabashi">â€•</span></button>
          <button class="tab-btn" onclick="switchTab('yamato',this)">æ±äº¬å¤§å’Œç—…é™¢<span class="tab-badge" id="badge-yamato">â€•</span></button>
          <button class="tab-btn" onclick="switchTab('uenohara',this)">ä¸Šé‡åŸå¸‚ç«‹ç—…é™¢<span class="tab-badge" id="badge-uenohara">â€•</span></button>
        </div>

        <!-- æ¿æ©‹ä¸­å¤® -->
        <div class="tab-panel active" id="panel-itabashi">
          <div class="notice info" style="margin-top:4px;">
            <span class="notice-icon">ğŸ“‹</span>
            <div>3æœˆã®å…¨å½“ç›´æ—¥ç¨‹ã§ã™ï¼ˆæ—¥æ›œãƒ»ç¥æ—¥é™¤ãï¼‰ã€‚<strong>é’è‰²ã®è¡Œ</strong>ã¯ã‚ãªãŸã®æ‹…å½“æ›œæ—¥ã§ã™ã€‚æ‹…å½“æ›œæ—¥ä»¥å¤–ã‚‚ã™ã¹ã¦ã”å›ç­”ãã ã•ã„ã€‚</div>
          </div>
          <div class="bulk-row">
            <span class="bulk-lbl">ä¸€æ‹¬ï¼š</span>
            <button class="bulk-btn ok" onclick="bulkSet('itabashi','ok')">ã™ã¹ã¦ã€Œå¯ã€</button>
            <button class="bulk-btn ng" onclick="bulkSet('itabashi','ng')">ã™ã¹ã¦ã€Œä¸å¯ã€</button>
            <button class="bulk-btn" onclick="bulkMyDay('ok')">æ‹…å½“æ—¥ã®ã¿ã€Œå¯ã€</button>
          </div>
          <table class="pref-table">
            <thead><tr><th style="width:130px">æ—¥ä»˜</th><th style="width:80px">åŒºåˆ†</th><th>å¸Œæœ›</th></tr></thead>
            <tbody id="table-itabashi"></tbody>
          </table>
        </div>

        <!-- æ±äº¬å¤§å’Œ -->
        <div class="tab-panel" id="panel-yamato">
          <div class="notice warn" style="margin-top:4px;">
            <span class="notice-icon">âš ï¸</span>
            <div><strong>æ±äº¬å¤§å’Œç—…é™¢ã¸ã®æ´¾é£æ—¥ç¨‹</strong>ã§ã™ã€‚ç¬¬1æ—¥æ›œã®æ—¥ç›´ãƒ»å½“ç›´ã€ãŠã‚ˆã³æ°´æ›œ4æ—¥é–“ã®å½“ç›´ãŒå¯¾è±¡ã§ã™ã€‚</div>
          </div>
          <div class="bulk-row">
            <span class="bulk-lbl">ä¸€æ‹¬ï¼š</span>
            <button class="bulk-btn ok" onclick="bulkSet('yamato','ok')">ã™ã¹ã¦ã€Œå¯ã€</button>
            <button class="bulk-btn ng" onclick="bulkSet('yamato','ng')">ã™ã¹ã¦ã€Œä¸å¯ã€</button>
          </div>
          <table class="pref-table">
            <thead><tr><th style="width:130px">æ—¥ä»˜</th><th style="width:80px">åŒºåˆ†</th><th>å¸Œæœ›</th></tr></thead>
            <tbody id="table-yamato"></tbody>
          </table>
        </div>

        <!-- ä¸Šé‡åŸ -->
        <div class="tab-panel" id="panel-uenohara">
          <div class="notice warn" style="margin-top:4px;">
            <span class="notice-icon">âš ï¸</span>
            <div><strong>ä¸Šé‡åŸå¸‚ç«‹ç—…é™¢ã¸ã®æ´¾é£æ—¥ç¨‹</strong>ã§ã™ã€‚ç¬¬3åœŸæ›œæ—¥ï¼ˆ3æœˆ21æ—¥ï¼‰ã®å½“ç›´ãŒå¯¾è±¡ã§ã™ã€‚</div>
          </div>
          <table class="pref-table">
            <thead><tr><th style="width:130px">æ—¥ä»˜</th><th style="width:80px">åŒºåˆ†</th><th>å¸Œæœ›</th></tr></thead>
            <tbody id="table-uenohara"></tbody>
          </table>
        </div>

        <div class="comment-field">
          <label for="comment">ãã®ä»–ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰</label>
          <textarea id="comment" placeholder="ãã®ä»–ã®å¸Œæœ›ã‚„äº‹æƒ…ãŒã‚ã‚Œã°ã”è¨˜å…¥ãã ã•ã„â€¦"></textarea>
        </div>

        <div class="submit-wrap">
          <button class="btn btn-outline" onclick="resetForm()">â† åŒ»å¸«é¸æŠã¸æˆ»ã‚‹</button>
          <button class="btn btn-primary" onclick="showConfirm()">ç¢ºèªç”»é¢ã¸ â†’</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SUMMARY -->
  <div id="summary-view">
    <div class="card">
      <div style="text-align:center;padding:36px 24px 22px;">
        <div style="width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,var(--navy),var(--navy-mid));display:flex;align-items:center;justify-content:center;font-size:1.6rem;margin:0 auto 16px;box-shadow:0 8px 24px rgba(15,34,64,0.25);">ğŸ“‹</div>
        <h2 style="font-family:'Shippori Mincho',serif;font-size:1.2rem;color:var(--navy);margin-bottom:6px;" id="summary-title">å›ç­”ç¢ºèª</h2>
        <p style="font-size:0.81rem;color:var(--text-light);">å†…å®¹ã‚’ç¢ºèªã®ä¸Šã€é€ä¿¡ã—ã¦ãã ã•ã„</p>
      </div>
      <div style="padding:0 24px 32px;">
        <div class="tabs" id="summary-tabs">
          <button class="tab-btn active" onclick="switchSummTab('si',this)">æ¿æ©‹ä¸­å¤®</button>
          <button class="tab-btn" onclick="switchSummTab('sy',this)">æ±äº¬å¤§å’Œ</button>
          <button class="tab-btn" onclick="switchSummTab('su',this)">ä¸Šé‡åŸå¸‚ç«‹</button>
        </div>
        <div class="tab-panel active" id="panel-si" style="padding-top:14px;">
          <table class="summary-table"><thead><tr><th>æ—¥ä»˜</th><th>åŒºåˆ†</th><th>å¸Œæœ›</th></tr></thead><tbody id="summ-itabashi"></tbody></table>
        </div>
        <div class="tab-panel" id="panel-sy" style="padding-top:14px;">
          <table class="summary-table"><thead><tr><th>æ—¥ä»˜</th><th>åŒºåˆ†</th><th>å¸Œæœ›</th></tr></thead><tbody id="summ-yamato"></tbody></table>
        </div>
        <div class="tab-panel" id="panel-su" style="padding-top:14px;">
          <table class="summary-table"><thead><tr><th>æ—¥ä»˜</th><th>åŒºåˆ†</th><th>å¸Œæœ›</th></tr></thead><tbody id="summ-uenohara"></tbody></table>
        </div>
        <div style="margin-top:14px;padding:11px 13px;background:var(--cream);border-radius:8px;font-size:0.81rem;color:var(--text-mid);">
          <strong>ã‚³ãƒ¡ãƒ³ãƒˆï¼š</strong><span id="summ-comment">ãªã—</span>
        </div>
        <div class="submit-wrap">
          <button class="btn btn-outline" onclick="backToForm()">â† ä¿®æ­£ã™ã‚‹</button>
          <button class="btn btn-primary" onclick="submitForm()">ã“ã®å†…å®¹ã§é€ä¿¡ âœ“</button>
        </div>
      </div>
    </div>
  </div>

</main>

<script>
const DAY_NAMES = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
const DAY_CLS   = ['sun','mon','tue','wed','thu','fri','sat'];
const DOCTORS   = ['å®‰æœ¬','ç¦å¶‹','åŠ è—¤','æ¾å…ƒ','èµåŸ','å…¨','å’Œæ‰'];
const MY_DAY    = { 'å®‰æœ¬':1,'ç¦å¶‹':2,'åŠ è—¤':3,'æ¾å…ƒ':3,'èµåŸ':4,'å…¨':5,'å’Œæ‰':6 };

function dow(m,d){ return new Date(2026,m-1,d).getDay(); }

// æ¿æ©‹ä¸­å¤®ï¼š3æœˆå…¨æ—¥ã€æ—¥æ›œé™¤ãï¼ˆ3/21ã¯ä¸Šé‡åŸã®ã¿ã ãŒæ¿æ©‹ã«ã‚‚è¨˜è¼‰â†’åŒºåˆ¥ã¯è¡Œè‰²ã®ã¿ï¼‰
// å®Ÿé‹ç”¨ä¸Šã€3/21ã¯ä¸Šé‡åŸæ´¾é£æ—¥ãªã®ã§æ¿æ©‹ä¸­å¤®ã«ã¯å…¥ã‚Œãªã„
function buildItabashi(){
  const rows=[];
  for(let d=1;d<=31;d++){
    const dw=dow(3,d);
    if(dw===0) continue; // æ—¥æ›œâ†’æ±äº¬å¤§å’Œ
    if(d===21) continue; // ç¬¬3åœŸæ›œâ†’ä¸Šé‡åŸ
    rows.push({date:`3/${d}`,type:'å½“ç›´',dw});
  }
  return rows;
}

const ITABASHI = buildItabashi();
const YAMATO   = [
  {date:'3/1',type:'æ—¥ç›´',dw:0},
  {date:'3/1',type:'å½“ç›´',dw:0},
  {date:'3/4',type:'å½“ç›´',dw:3},
  {date:'3/11',type:'å½“ç›´',dw:3},
  {date:'3/18',type:'å½“ç›´',dw:3},
  {date:'3/25',type:'å½“ç›´',dw:3},
];
const UENOHARA = [
  {date:'3/21',type:'å½“ç›´',dw:6},
];

let currentDoc = null;
let submitted  = new Set(JSON.parse(localStorage.getItem('sub_v3')||'[]'));

function updateProgress(){
  const n=submitted.size;
  document.getElementById('progress-count').textContent=n;
  document.getElementById('progress-bar').style.width=(n/7*100)+'%';
  DOCTORS.forEach(d=>{
    document.querySelector(`.progress-doctor-tag[data-doc="${d}"]`).classList.toggle('done',submitted.has(d));
    const b=document.getElementById(`btn-${d}`);
    if(b) b.classList.toggle('submitted',submitted.has(d));
  });
}

function rkey(fac,date,type,i){ return `${fac}__${date}__${type}__${i}`; }

function buildRow(item,fac,idx,doc){
  const isMyDay = item.dw===MY_DAY[doc] && fac==='itabashi';
  const rowCls  = fac==='yamato'?'ext-yamato':fac==='uenohara'?'ext-uenohara':isMyDay?'my-day':'';
  const key     = rkey(fac,item.date,item.type,idx);
  const myLbl   = isMyDay?'<span class="my-lbl">æ‹…å½“</span>':'';
  return `<tr class="${rowCls}" data-myday="${isMyDay?1:0}">
    <td class="date-cell">${item.date}<span class="day-badge ${DAY_CLS[item.dw]}">${DAY_NAMES[item.dw]}</span>${myLbl}</td>
    <td><span class="duty-type">${item.type}</span></td>
    <td><div class="pref-radio-group">
      <input type="radio" name="${key}" id="${key}_ok" value="ok"><label for="${key}_ok">å¯</label>
      <input type="radio" name="${key}" id="${key}_prefer" value="prefer"><label for="${key}_prefer">å¸Œæœ›ã™ã‚‹</label>
      <input type="radio" name="${key}" id="${key}_ng" value="ng"><label for="${key}_ng">ä¸å¯</label>
    </div></td>
  </tr>`;
}

function selectDoctor(doc){
  currentDoc=doc;
  document.querySelectorAll('.doctor-btn').forEach(b=>b.classList.remove('selected'));
  document.getElementById(`btn-${doc}`).classList.add('selected');
  document.getElementById('form-doctor-name').textContent=doc+' å…ˆç”Ÿ';

  document.getElementById('table-itabashi').innerHTML=ITABASHI.map((r,i)=>buildRow(r,'itabashi',i,doc)).join('');
  document.getElementById('table-yamato').innerHTML=YAMATO.map((r,i)=>buildRow(r,'yamato',i,doc)).join('');
  document.getElementById('table-uenohara').innerHTML=UENOHARA.map((r,i)=>buildRow(r,'uenohara',i,doc)).join('');

  const saved=JSON.parse(localStorage.getItem(`pref_v3_${doc}`)||'null');
  if(saved){
    Object.entries(saved).forEach(([k,v])=>{
      if(k==='comment') return;
      const el=document.querySelector(`input[name="${k}"][value="${v}"]`);
      if(el) el.checked=true;
    });
    document.getElementById('comment').value=saved.comment||'';
  }

  document.querySelectorAll('.pref-radio-group input').forEach(el=>el.addEventListener('change',updateBadges));
  updateBadges();

  document.getElementById('form-content').classList.add('visible');
  document.getElementById('summary-view').classList.remove('visible');
  switchTab('itabashi', document.querySelector('#form-tabs .tab-btn'));
  setStep(2);
  window.scrollTo({top:0,behavior:'smooth'});
}

function switchTab(name,btn){
  document.querySelectorAll('#form-tabs .tab-btn').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
  ['itabashi','yamato','uenohara'].forEach(n=>document.getElementById(`panel-${n}`).classList.remove('active'));
  document.getElementById(`panel-${name}`).classList.add('active');
}

function switchSummTab(name,btn){
  document.querySelectorAll('#summary-tabs .tab-btn').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
  ['si','sy','su'].forEach(n=>document.getElementById(`panel-${n}`).classList.remove('active'));
  document.getElementById(`panel-${name}`).classList.add('active');
}

function bulkSet(fac,val){
  document.getElementById(`table-${fac}`).querySelectorAll(`input[value="${val}"]`).forEach(el=>{el.checked=true;});
  updateBadges();
}
function bulkMyDay(val){
  document.getElementById('table-itabashi').querySelectorAll('tr[data-myday="1"]').forEach(tr=>{
    const inp=tr.querySelector(`input[value="${val}"]`); if(inp) inp.checked=true;
  });
  updateBadges();
}

function updateBadges(){
  [['itabashi','badge-itabashi'],['yamato','badge-yamato'],['uenohara','badge-uenohara']].forEach(([fac,bid])=>{
    const tbody=document.getElementById(`table-${fac}`); if(!tbody) return;
    const total=tbody.querySelectorAll('tr').length;
    const answered=tbody.querySelectorAll('input:checked').length;
    const ng=tbody.querySelectorAll('input[value="ng"]:checked').length;
    const prefer=tbody.querySelectorAll('input[value="prefer"]:checked').length;
    const el=document.getElementById(bid); if(!el) return;
    el.className='tab-badge';
    if(ng>0){ el.textContent=`ä¸å¯${ng}`; el.classList.add('ng'); }
    else if(prefer>0){ el.textContent=`å¸Œæœ›${prefer}`; el.classList.add('prefer'); }
    else{ el.textContent=`${answered}/${total}`; }
  });
}

function collectData(){
  const d={};
  document.querySelectorAll('.pref-radio-group input:checked').forEach(el=>{d[el.name]=el.value;});
  d.comment=document.getElementById('comment').value;
  return d;
}

function pillHtml(val){
  const m={ok:['pref-ok','å¯'],prefer:['pref-prefer','å¸Œæœ›ã™ã‚‹'],ng:['pref-ng','ä¸å¯']};
  return val?`<span class="pref-pill ${m[val][0]}">${m[val][1]}</span>`:`<span class="pref-pill pref-unset">æœªå›ç­”</span>`;
}

function showConfirm(){
  const data=collectData();
  localStorage.setItem(`pref_v3_${currentDoc}`,JSON.stringify(data));
  document.getElementById('summary-title').textContent=currentDoc+' å…ˆç”Ÿã®å›ç­”ç¢ºèª';

  function rows(list,fac){
    return list.map((item,i)=>{
      const key=rkey(fac,item.date,item.type,i);
      const isMyDay=item.dw===MY_DAY[currentDoc]&&fac==='itabashi';
      const myLbl=isMyDay?'<span class="my-lbl">æ‹…å½“</span>':'';
      return `<tr><td class="date-cell">${item.date}<span class="day-badge ${DAY_CLS[item.dw]}">${DAY_NAMES[item.dw]}</span>${myLbl}</td><td><span class="duty-type">${item.type}</span></td><td>${pillHtml(data[key])}</td></tr>`;
    }).join('');
  }
  document.getElementById('summ-itabashi').innerHTML=rows(ITABASHI,'itabashi');
  document.getElementById('summ-yamato').innerHTML=rows(YAMATO,'yamato');
  document.getElementById('summ-uenohara').innerHTML=rows(UENOHARA,'uenohara');
  document.getElementById('summ-comment').textContent=data.comment||'ãªã—';

  document.getElementById('form-content').classList.remove('visible');
  document.getElementById('summary-view').classList.add('visible');
  switchSummTab('si', document.querySelector('#summary-tabs .tab-btn'));
  setStep(3);
  window.scrollTo({top:0,behavior:'smooth'});
}

function backToForm(){
  document.getElementById('form-content').classList.add('visible');
  document.getElementById('summary-view').classList.remove('visible');
  setStep(2);
}
function resetForm(){
  currentDoc=null;
  document.querySelectorAll('.doctor-btn').forEach(b=>b.classList.remove('selected'));
  document.getElementById('form-content').classList.remove('visible');
  document.getElementById('summary-view').classList.remove('visible');
  setStep(1);
}
function submitForm(){
  submitted.add(currentDoc);
  localStorage.setItem('sub_v3',JSON.stringify([...submitted]));
  updateProgress();
  document.getElementById('summary-view').innerHTML=`
    <div class="card card-anim">
      <div style="text-align:center;padding:52px 24px;">
        <div style="width:68px;height:68px;border-radius:50%;background:linear-gradient(135deg,#16a34a,#4ade80);display:flex;align-items:center;justify-content:center;font-size:2rem;margin:0 auto 18px;box-shadow:0 8px 24px rgba(22,163,74,0.3);">âœ“</div>
        <h2 style="font-family:'Shippori Mincho',serif;font-size:1.3rem;color:var(--navy);margin-bottom:10px;">${currentDoc} å…ˆç”Ÿã®å›ç­”ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸ</h2>
        <p style="color:var(--text-light);font-size:0.84rem;line-height:1.9;margin-bottom:28px;">ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚<br>å›ç­”å†…å®¹ã¯ç®¡ç†è€…ãŒç¢ºèªã—ã€å½“ç›´è¡¨ã®ä½œæˆã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</p>
        <button class="btn btn-primary" onclick="location.reload()">åˆ¥ã®åŒ»å¸«ã®å›ç­”ã‚’å…¥åŠ›ã™ã‚‹</button>
      </div>
    </div>`;
  setStep(4);
  window.scrollTo({top:0,behavior:'smooth'});
}
function setStep(n){
  for(let i=1;i<=4;i++){
    const el=document.getElementById(`step${i}`);
    el.classList.remove('active','done');
    if(i<n) el.classList.add('done');
    else if(i===n) el.classList.add('active');
  }
}

updateProgress();
</script>
</body>
</html>
